- name: Install Oracle Java version 8
  hosts: java
  become: true
  
  tasks:
    - name: Set authorized key for user ubuntu copying it from current user
      authorized_key:
            user: ubuntu
            state: present
            key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"
    - name: Create directoy
      file:
        path: /sites
        state: directory
        recurse: yes
        owner: ubuntu
        group: ubuntu
    - name: Copy java tar file
      copy: src=jdk-8u221-linux-x64.tar.gz dest=/sites mode=0755
      become_user: ubuntu
    - name: Untar java
      shell: cd /sites && tar xf jdk-8u221-linux-x64.tar.gz
      become_user: ubuntu
    - name: add java home and path bashrc file
      lineinfile:
          dest: ~/.bashrc
          regexp: '^JAVA_HOME'
          line: "{{ item }}" 
          state: present
      with_items:
           - "{{ '#Java home' }}"
           - "{{ 'export JAVA_HOME=/sites/jdk1.8.0_221' }}" 
           - "{{ 'export PATH=$JAVA_HOME/bin:$PATH' }}"
      become_user: ubuntu
    - name: Create symbolic link to java
      shell: ln -s /sites/jdk1.8.0_221/bin/java /usr/bin/java
    - debug: msg="Java Installation is complete.. login in to server and check version 'java -version'"
    - name: Copy maven tar dile
      copy: src=apache-maven-3.6.2-bin.tar.gz dest=/sites mode=0755
    - name: Untar maven 
      shell: cd /sites && tar xf apache-maven-3.6.2-bin.tar.gz
    - name: add maven home and path to bashrc file
      lineinfile:
          dest: ~/.bashrc
          regexp: '^M2_HOME'
          line: "{{ item }}"
          state: present
      with_items:
           - "{{ '#Maven home' }}"
           - "{{ 'export M2_HOME=/sites/apache-maven-3.6.2' }}"
           - "{{ 'export PATH=$M2_HOME/bin:$PATH' }}"
      become_user: ubuntu
    - debug: msg="Maven Installation is complete.. login in to Server and check version 'mvn -v'"
